<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‚´ ê°•ì˜ì‹¤ - ìˆ˜ê°•í•œ ê°•ì˜</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <link rel="stylesheet" th:href="@{/css/user_course.css}">
    <style>
       
    </style>
</head>
<body>
    <!-- ëª¨ë°”ì¼ ë©”ë‰´ í† ê¸€ -->
    <button class="mobile-menu-toggle" onclick="toggleMobileMenu()">
        â˜°
    </button>

    <!-- ëª¨ë°”ì¼ ì˜¤ë²„ë ˆì´ -->
    <div class="mobile-overlay" onclick="toggleMobileMenu()"></div>

    <div class="container-fluid">
        <div class="row">
            <!-- ì‚¬ì´ë“œë°” -->
            <div class="sidebar" id="sidebar">
                <a href="#" class="active">ğŸ“š ë‚´ ê°•ì˜ì‹¤</a>
                <a href="#">ğŸ§  í€´ì¦ˆ</a>
                <a href="#">ğŸ‘¤ ë§ˆì´í˜ì´ì§€</a>
                <a href="#">ğŸ“‚ ë” ë³´ê¸°</a>
                <a href="#">ğŸ« ê°•ì˜ ì°¾ê¸°</a>
            </div>

            <!-- ë©”ì¸ ì½˜í…ì¸  -->
            <div class="main-content">
                <!-- í—¤ë” ì„¹ì…˜ -->
                <div class="header-section">
                    <h1 class="main-title">ë‚´ ê°•ì˜ì‹¤/ìˆ˜ê°•í•œ ê°•ì˜</h1>
                    <p class="subtitle">ìˆ˜ê°• ì¤‘ì¸ ê°•ì˜ë“¤ì„ í™•ì¸í•˜ê³  í•™ìŠµì„ ì´ì–´ê°€ì„¸ìš”</p>
                </div>

                <!-- í•„í„° ì„¹ì…˜ -->
                <div class="filter-section">
                    <div class="filter-row">
                        <div class="filter-group">
                            <label for="categoryFilter">ì¹´í…Œê³ ë¦¬</label>
                            <select id="categoryFilter" class="filter-select" onchange="filtercourses()">
                                <option value="">ì „ì²´</option>
                                <option value="ì˜ì–´">ì˜ì–´</option>
                                <option value="ì¼ë³¸ì–´">ì¼ë³¸ì–´</option>
                                <option value="ì¤‘êµ­ì–´">ì¤‘êµ­ì–´</option>
                            </select>
                        </div>
                        
                        <div class="filter-group">
                            <label for="difficultyFilter">ë‚œì´ë„</label>
                            <select id="difficultyFilter" class="filter-select" onchange="filtercourses()">
                                <option value="">ì „ì²´</option>
                                <option value="ì´ˆê¸‰">ì´ˆê¸‰</option>
                                <option value="ì¤‘ê¸‰">ì¤‘ê¸‰</option>
                                <option value="ê³ ê¸‰">ê³ ê¸‰</option>
                            </select>
                        </div>

                        <div class="filter-group search-group">
                            <label for="searchInput">ê°•ì˜ëª… ê²€ìƒ‰</label>
                            <input type="text" id="searchInput" class="search-input" placeholder="ê°•ì˜ëª…ì„ ì…ë ¥í•˜ì„¸ìš”" oninput="filtercourses()">
                        </div>
                    </div>
                </div>

                <!-- ê°•ì˜ ëª©ë¡ -->
                <div class="course-grid" id="courseGrid">
                    <!-- ê°•ì˜ ì¹´ë“œë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                </div>

                <!-- ë¹ˆ ìƒíƒœ -->
                <div class="empty-state" id="emptyState" style="display: none;">
                    <div class="empty-icon">ğŸ“š</div>
                    <div class="empty-title">ìˆ˜ê°• ì¤‘ì¸ ê°•ì˜ê°€ ì—†ìŠµë‹ˆë‹¤</div>
                    <div class="empty-description">
                        ìƒˆë¡œìš´ ê°•ì˜ë¥¼ ì°¾ì•„ì„œ í•™ìŠµì„ ì‹œì‘í•´ë³´ì„¸ìš”!
                    </div>
                </div>
               <div class="pagination-container">
				  <div class="pagination" id="pagination"></div>
				</div>

            </div>
        </div>
    </div>

    <script>
        let currentPage = 1;
        const limit = 5; // ê·¸ë¦¬ë“œ í˜•íƒœë¡œ 3x3 ë°°ì¹˜
        let allCourses = []; // ì „ì²´ ê°•ì˜ ë°ì´í„°
        let filteredCourses = []; // í•„í„°ë§ëœ ê°•ì˜ ë°ì´í„°

        // í˜ì´ì§€ ë¡œë“œì‹œ ê°•ì˜ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
        window.addEventListener("DOMContentLoaded", () => {
            loadCourses(1);
        });

        // ìˆ˜ê°• ì¤‘ì¸ ê°•ì˜ ëª©ë¡ ë¡œë“œ
        async function loadCourses(page = 1) {
        	currentPage = page;
            try {
                const response = await axios.get(`/user/showUserCourses?page=${page}&limit=${limit}`);
                allCourses = response.data.courses;
                const userCourseList = response.data.userCourseList;
                const totalCount = response.data.totalCount;
                filteredCourses = [...allCourses];
                
                
                renderCourses();
                getPagination(totalCount, page, limit);
                
                if (allCourses.length === 0) {
                    showEmptyState();
                }
            } catch (error) {
                console.error('ê°•ì˜ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', error);
                // ë°ëª¨ ë°ì´í„°ë¡œ ëŒ€ì²´
                loadDemoData();
            }
        }


        // ê°•ì˜ ëª©ë¡ ë Œë”ë§
        function renderCourses() {
            const grid = document.getElementById('courseGrid');
            const emptyState = document.getElementById('emptyState');
            
            if (filteredCourses.length === 0) {
                grid.innerHTML = '';
                emptyState.style.display = 'block';
                return;
            }
            
            emptyState.style.display = 'none';
            
            const startIndex = (currentPage - 1) * limit;
            const endIndex = startIndex + limit;
            const pageData = filteredCourses.slice(startIndex, endIndex);
            
            grid.innerHTML = pageData.map(course => createCourseCard(course)).join('');
        }

        // ê°•ì˜ ì¹´ë“œ ìƒì„±
        function createCourseCard(course) {
            const progressPercent = course.progress || 0;
            const defaultImage = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzUwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDM1MCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIzNTAiIGhlaWdodD0iMjAwIiBmaWxsPSIjZjBmN2ZmIi8+CjxjaXJjbGUgY3g9IjE3NSIgY3k9IjEwMCIgcj0iNDAiIGZpbGw9IiM0YTkwZTIiLz4KPHN2ZyB4PSIxNTUiIHk9IjgwIiB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSI+CjxwYXRoIGQ9Ik0xNSAxMkwyNSAyMEwxNSAyOFYxMloiIGZpbGw9IndoaXRlIi8+Cjwvc3ZnPgo8L3N2Zz4K';
            
            return `
                <div class="course-card">
                    <div class="card-thumbnail">
                        <img src="${course.thumbnailPath || defaultImage}" alt="${course.courseTitle}" 
                             onerror="this.src='${defaultImage}'">
                        <div class="progress-overlay">
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${progressPercent}%"></div>
                            </div>
                            <div class="progress-text">${progressPercent}% ì™„ë£Œ (${course.completedLessons || 0}/${course.totalLessons || 0})</div>
                        </div>
                    </div>
                    <div class="card-content">
                        <div class="card-badges">
                            <span class="badge badge-category">${course.category}</span>
                            <span class="badge badge-difficulty badge-${course.difficulty}">${course.difficulty}</span>
                        </div>
                        <h3 class="card-title">${course.courseTitle}</h3>
                        <p class="card-description">${course.introduction || 'ê°•ì˜ ì„¤ëª…ì´ ì—†ìŠµë‹ˆë‹¤.'}</p>
                        <div class="card-stats">
                            <div class="stat-group">
                                <div class="stat-item">
                                    <span>ğŸ“…</span>
                                    <span>ìˆ˜ê°•ì‹œì‘: ${formatDate(course.enrollDate)}</span>
                                </div>
                                <div class="stat-item">
                                    <span>ğŸ•’</span>
                                    <span>ìµœê·¼í•™ìŠµ: ${formatDate(course.lastStudied)}</span>
                                </div>
                            </div>
                        </div>
                        <div class="card-actions">
                            <button class="btn btn-primary" onclick="continueLearning('${course.courseSeq}')">
                                ${progressPercent > 0 ? 'í•™ìŠµ ê³„ì†í•˜ê¸°' : 'í•™ìŠµ ì‹œì‘'}
                            </button>
                            <button class="btn btn-outline" onclick="viewCourseDetail(${course.courseSeq})">
                                ê°•ì˜ ì •ë³´
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        // ë‚ ì§œ í¬ë§· í•¨ìˆ˜
        function formatDate(dateString) {
            if (!dateString) return '-';
            const date = new Date(dateString);
            const year = date.getFullYear();
            const month = date.getMonth() + 1; // ì›”ì€ 0ë¶€í„° ì‹œì‘í•¨
            const day = date.getDate();
           	
            return `${year}ë…„ ${month}ì›” ${day}ì¼`;
        }

        // ê°•ì˜ í•„í„°ë§
//         function filterCourses() {
//             const categoryFilter = document.getElementById('categoryFilter').value;
//             const difficultyFilter = document.getElementById('difficultyFilter').value;
//             const searchInput = document.getElementById('searchInput').value.toLowerCase();
            
//             filteredCourses = allCourses.filter(course => {
//                 const matchCategory = !categoryFilter || course.category === categoryFilter;
//                 const matchDifficulty = !difficultyFilter || course.difficulty === difficultyFilter;
//                 const matchSearch = !searchInput || course.courseTitle.toLowerCase().includes(searchInput);
                
//                 return matchCategory && matchDifficulty && matchSearch;
//             });
            
//             currentPage = 1; // í•„í„° ì ìš©ì‹œ ì²« í˜ì´ì§€ë¡œ
//             renderCourses();
//             renderPagination();
//         }

        // í˜ì´ì§€ë„¤ì´ì…˜ ë Œë”ë§
    function getPagination(totalCount, currentPage, limit) {
    const pagination = document.getElementById("pagination");
    pagination.innerHTML = "";

    const totalPages = Math.ceil(totalCount / limit);
    const maxButtons = 5;

    // í˜„ì¬ í˜ì´ì§€ê°€ í¬í•¨ëœ ë¸”ë¡ ê³„ì‚°
    const currentBlock = Math.floor((currentPage - 1) / maxButtons);
    const startPage = currentBlock * maxButtons + 1;
    const endPage = Math.min(startPage + maxButtons - 1, totalPages);

    // ì´ì „ ë¸”ë¡ ë²„íŠ¼
    if (startPage > 1) {
        const prevBtn = document.createElement("button");
        prevBtn.textContent = "<";
        prevBtn.className = "btn btn-sm btn-outline-secondary m-1";
        prevBtn.addEventListener("click", () => {
            loadCourses(startPage - 1);
        });
        pagination.appendChild(prevBtn);
    }

    // í˜ì´ì§€ ë²ˆí˜¸ ë²„íŠ¼
    for (let i = startPage; i <= endPage; i++) {
        const btn = document.createElement("button");
        btn.className = "btn btn-sm btn-outline-primary m-1";
        btn.textContent = i;

        if (i === currentPage) {
            btn.classList.add("active");
        }

        btn.addEventListener("click", () => {
            loadCourses(i);
        });

        pagination.appendChild(btn);
    }

    // ë‹¤ìŒ ë¸”ë¡ ë²„íŠ¼
    if (endPage < totalPages) {
        const nextBtn = document.createElement("button");
        nextBtn.textContent = ">";
        nextBtn.className = "btn btn-sm btn-outline-secondary m-1";
        nextBtn.addEventListener("click", () => {
            loadCourse(endPage + 1);
        });
        pagination.appendChild(nextBtn);
    }
}

        // í˜ì´ì§€ ì´ë™
        function goToPage(page) {
            currentPage = page;
            renderCourses();
            renderPagination();
        }

        // ë¹ˆ ìƒíƒœ í‘œì‹œ
        function showEmptyState() {
            document.getElementById('courseGrid').innerHTML = '';
            document.getElementById('emptyState').style.display = 'block';
        }

        // í•™ìŠµ ê³„ì†í•˜ê¸°
        function continueLearning(courseSeq) {
            location.href = "/ui/user_lecture?seq="+courseSeq;
        }

        // ê°•ì˜ ìƒì„¸ ì •ë³´
        function viewCourseDetail(courseSeq) {
            window.location.href = `/course/detail/${courseSeq}`;
        }

        // ëª¨ë°”ì¼ ë©”ë‰´ í† ê¸€
        function toggleMobileMenu() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.querySelector('.mobile-overlay');
            
            sidebar.classList.toggle('active');
            overlay.classList.toggle('active');
        }

        // ì‚¬ì´ë“œë°” ë§í¬ í™œì„±í™”
        document.querySelectorAll('.sidebar a').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                document.querySelectorAll('.sidebar a').forEach(a => a.classList.remove('active'));
                this.classList.add('active');
                
                // ëª¨ë°”ì¼ì—ì„œ ë©”ë‰´ í´ë¦­ ì‹œ ì‚¬ì´ë“œë°” ë‹«ê¸°
                if (window.innerWidth <= 768) {
                    toggleMobileMenu();
                }
            });
        });

        // ìœˆë„ìš° ë¦¬ì‚¬ì´ì¦ˆ ì‹œ ì‚¬ì´ë“œë°” ìƒíƒœ ì´ˆê¸°í™”
        window.addEventListener('resize', function() {
            if (window.innerWidth > 768) {
                document.getElementById('sidebar').classList.remove('active');
                document.querySelector('.mobile-overlay').classList.remove('active');
            }
        });
    </script>